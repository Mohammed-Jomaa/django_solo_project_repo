{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² Ùˆ Ø§Ù„Ù†Ù‚Ø§Ø·</title>
  <link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'CSS/style.css' %}" rel="stylesheet">
  <style>
    .reward-image-container {
      width: 100%;
      height: 200px;
      overflow: hidden;
      border-radius: 10px;
    }

    .reward-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
    }
  </style>
</head>

<body>
  <header>
    <nav class="navbar navbar-light bg-white shadow-sm">
      <div class="container d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-2">
          <img src="{% static 'images/logo.png' %}" width="40" height="40" />
          <span class="fw-bold brand-orange fs-5">Ø¨ÙÙ†Ø§Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„</span>
        </div>
        <a href="{% url 'logout' %}" class="btn btn-orange">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
      </div>
    </nav>
  </header>

  <main class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3 class="fw-bold">ğŸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² {{ family.name }}</h3>
      <a href="{% url 'create_reward' family.id %}" class="btn btn-orange">â• Ø¥Ø¶Ø§ÙØ© Ø¬Ø§Ø¦Ø²Ø©</a>
    </div>

    {% if rewards %}
    <div class="row g-4">
      {% for reward in rewards %}
      <div class="col-md-4">
        <div class="card shadow-sm h-100 text-center p-3">
          <div class="reward-image-container mb-3">
            {% if reward.image %}
            <img src="{{ reward.image.url }}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©" class="reward-image">
            {% else %}
            <img src="{% static 'images/gift.png' %}" alt="ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©" class="reward-image">
            {% endif %}
          </div>
          <h5 class="fw-bold">{{ reward.title }}</h5>
          <p class="mb-2">ØªÙƒÙ„ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø·: <strong>{{ reward.points_cost }}</strong></p>
          <form id="delete-reward-form-{{ reward.id }}" action="{% url 'delete_reward' reward.id %}" method="post"
            style="display: none;">
            {% csrf_token %}
          </form>

          <button type="button" class="btn btn-danger mb-2" onclick="confirmDeleteReward({{ reward.id }})">ğŸ—‘ï¸ Ø­Ø°Ù
            Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©</button>


        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-muted text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬ÙˆØ§Ø¦Ø² Ù…Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯.</p>
    {% endif %}

    <section>
      <hr class="my-5">
      <h5 class="fw-bold mb-3">ğŸ“¦ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² Ø§Ù„ØªÙŠ ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§:</h5>

      {% if redemptions %}
      <table class="table table-bordered text-center">
        <thead class="table-light">
          <tr>
            <th>Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„</th>
            <th>Ø§Ø³Ù… Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©</th>
            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„</th>
          </tr>
        </thead>
        <tbody>
          {% for item in redemptions %}
          <tr>
            <td>{{ item.child.first_name }} {{ item.child.last_name }}</td>
            <td>{{ item.reward.title }}</td>
            <td>{{ item.reward.points_cost }}</td>
            <td>{{ item.claimed_at|date:"Y-m-d H:i" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¨Ø¹Ø¯.</p>
      {% endif %}

    </section>

    <div class="text-center mt-4">
      <a href="{% url 'manage_family' family.id %}" class="btn btn-outline-orange">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</a>
    </div>
  </main>
  <footer class="text-center text-muted py-3 mt-5">
    <a href="{% url 'about' %}">Ù…Ù† Ù†Ø­Ù†</a> | Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2025
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script>
    function confirmDeleteReward(rewardId) {
      Swal.fire({
        title: 'ğŸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
        text: "Ø³ÙŠØªÙ… Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°ÙÙ‡Ø§',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
        reverseButtons: true,
        customClass: {
          confirmButton: 'btn btn-danger mx-2',
          cancelButton: 'btn btn-outline-secondary'
        },
        buttonsStyling: false
      }).then((result) => {
        if (result.isConfirmed) {
          document.getElementById(`delete-reward-form-${rewardId}`).submit();
        }
      });
    }
  </script>

</body>

</html>