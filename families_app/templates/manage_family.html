{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</title>
  <link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet" />
  <link href="{% static 'CSS/style.css' %}" rel="stylesheet" />
  <style>
    img {
      height: max-content;
    }
  </style>
</head>

<body>
  <header>
    <nav class="navbar navbar-light bg-white shadow-sm">
      <div class="container d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-2">
          <img src="{% static 'images/logo.png' %}" width="40" height="40" />
          <span class="fw-bold brand-orange fs-5">Ø¨ÙÙ†Ø§Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„</span>
        </div>
        <a href="{% url 'logout' %}" class="btn btn-orange">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
        
      </div>
    </nav>
  </header>

<main class="container  py-4">
<h2 class="fw-bold text-center mb-4">ğŸ‘‹ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ø¦Ù„Ø© {{ family.name }}</h2>



  {% if request.session.user_id == family.owner.id %}
  <div class="mb-4">

    <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">

      <form action="{% url 'add_admin' %}" method="post" class="d-flex align-items-center gap-2">
  {% csrf_token %}
  <input type="hidden" name="family_id" value="{{ family.id }}">
  <input type="email" name="email" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø´Ø±Ù"
    required>
  <button type="submit" class=" btn btn-outline-orange add-btn" style="white-space: nowrap;"> Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù</button>
</form>


        <form id="deleteFamilyForm" method="post">
          {% csrf_token %}
          <input type="hidden" name="family_id" value="{{ family.id }}">
          <button type="submit" class="btn btn-danger mb-2">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</button>
        </form>

    </div>

    <div id="deleteMessage" class="mt-3"></div>

{% for message in messages %}
  {% if 'error' in message.tags %}
    <div class="alert alert-danger text-center">
  {% else %}
    <div class="alert alert-{{ message.tags }} text-center">
  {% endif %}
      {{ message }}
    </div>
{% endfor %}


  </div>

  
  {% endif %}

    <div class="row g-4 justify-content-center text-center mb-4">
      <div class="col-md-3">
        <a href="{% url 'task_list' family.id %}" class="card shadow-sm h-100 text-decoration-none text-dark d-block">
          <img src="{% static 'images/tasks.png' %}" class="card-img-top" alt="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…">
          <div class="card-body">
            <h5 class="card-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</h5>
          </div>
        </a>
      </div>

      <div class="col-md-3">
        <a href="{% url 'review_tasks' family.id %}" class="card shadow-sm h-100 text-decoration-none text-dark d-block">
          <img src="{% static 'images/tttt.png' %}" class="card-img-top" alt="Ù…Ù‡Ø§Ù… Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©">
          <div class="card-body">
            <h5 class="card-title">Ù…Ù‡Ø§Ù… Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h5>
          </div>
        </a>
      </div>

      <div class="col-md-3">
        <a href="{% url 'children' family.id %}" class="card shadow-sm h-100 text-decoration-none text-dark d-block">
          <img src="{% static 'images/family.png' %}" class="card-img-top" alt="Ø§Ù„Ø£Ø·ÙØ§Ù„">
          <div class="card-body">
            <h5 class="card-title">Ø§Ù„Ø£Ø·ÙØ§Ù„</h5>
          </div>
        </a>
      </div>

      <div class="col-md-3">
        <a href="{% url 'rewards' family.id %}" class="card shadow-sm h-100 text-decoration-none text-dark d-block">
          <img src="{% static 'images/climped.png' %}" class="card-img-top" alt="Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² ÙˆØ§Ù„Ù†Ù‚Ø§Ø·">
          <div class="card-body">
            <h5 class="card-title">Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² ÙˆØ§Ù„Ù†Ù‚Ø§Ø·</h5>
          </div>
        </a>
      </div>
    </div>
    <div class="d-flex justify-content-end mb-4">
  <a href="{% url 'dashboard' %}" class="btn btn-orange">Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
</div>
  </main>

  <script>
    document.getElementById('deleteFamilyForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©ØŸ")) return;

      const form = e.target;
      const data = new FormData(form);
      const csrfToken = data.get("csrfmiddlewaretoken");

      const response = await fetch("{% url 'delete_family' %}", {
        method: "POST",
        headers: { "X-CSRFToken": csrfToken },
        body: data
      });

      const result = await response.json();
      if (result.success) {
        window.location.href = result.redirect_url;
      } else {
        document.getElementById("deleteMessage").innerHTML =
          `<div class="alert alert-danger">${result.error}</div>`;
      }
    });
  </script>

  <script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
</body>

</html>
